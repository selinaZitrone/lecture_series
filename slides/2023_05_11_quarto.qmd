---
title: "Reproducible documents with Quarto"
subtitle: "Scientific workflows: Tools and Tips :hammer::bulb:"
date: "2023-04-20"
format: 
  revealjs:
    footer: "Reproducible documents with Quarto"
    highlight-style: printing
    mainfont: Cabinet Grotesk
    slide-number: true
    show-slide-number: all
    incremental: true
    code-line-numbers: false
    theme: slides.scss
editor: source
execute: 
  echo: false
  eval: true
from: markdown+emoji
---

## What is this lecture series?

### Scientific workflows: Tools and Tips :hammer_and_wrench:

. . .

:date: Every 3rd Thursday :clock4: 4-5 p.m. :round_pushpin: Webex

-   One topic from the world of scientific workflows
-   For topic suggestions [send me an email](mailto:selina.baldauf@fu-berlin.de)
-   If you don't want to miss a lecture
    -   Check out the [lecture website](https://www.bcp.fu-berlin.de/en/graduiertenzentrum/promovierende/veranstaltungen/workshops/lecture-SB/index.html)
    -   [Subscribe to the mailing list](https://lists.fu-berlin.de/listinfo/toolsAndTips)
-   Slides provided [on Github](https://selinazitrone.github.io/tools_and_tips/)

## Reproducible documents with Quarto

. . .

> Quarto is an open-source scientific and technical publishing system

. . .

Basic idea: Create documents with dynamic content and text

```{r}
#| echo: false
#| fig-cap: Artwork from "Hello, Quarto" keynote by Julia Lowndes and Mine Çetinkaya-Rundel, presented at RStudio Conference 2022. Illustrated by [Allison Horst](https://allisonhorst.com)
#| fig-align: center
#| fig-alt: A schematic representing the multi-language input (e.g. Python, R, Observable, Julia) and multi-format output (e.g. PDF, html, Word documents, and more) versatility of Quarto.
knitr::include_graphics("images/2023_05_11_quarto/different_input.png")
```

## Reproducible documents with Quarto

Document types that can be created with Quarto (examples):

-   Documents: HTML, PDF, Word
-   Presentations: HTML, Powerpoint
-   Books: HTML, ePub, PDF
-   Websites

## Before we start

Quarto is a huge topic and there are so many cool Quarto things out there!

. . .

**Goal of today:** Introduction to Quarto and an overview of different document types and their possibilities.

- Focus on R and R Studio
- Keep in mind: This also works with other languages and other IDEs or text editors.

## How to get Quarto

Different options, depending on your workflow

-   **Integrated in** new versions of **R Studio** (Update R Studio via `Help -> Check for Updates`)
-   Download the **CLI** for use with other IDE (e.g. Visual Studio code)
-   **R package** `quarto` that provides an interface to Quarto (preconditions are Quarto CLI or new version of R Studio)

. . .

```{r}
#| eval: false
#| echo: true
install.packages("quarto")
```

. . .

<br>

Check out the [Quarto website](https://quarto.org/) for download and more info.

# The classic use case

> Reproducible documents for data analysis

## An example document

Download the demo project from [Github]()

:::{.columns}

:::{.column width="50%"}

An HTML example

```{r}
#|label: penguin-html
knitr::include_graphics("images/2023_05_11_quarto/quarto_penguin_html_example.png")
```

:::

:::{.column width="50%"}

A PDF example:

```{r}
#| label: penguin-pdf
knitr::include_graphics("images/2023_05_11_quarto/quarto_penguin_pdf_example.png")
```

:::

:::

## A standard workflow

<br>

![](images/2023_05_11_quarto/classic_workflow.png)

. . .

<br>

**Problem:** Manual updates are **error prone** and **non-reproducible**

## A Quarto workflow

**Solution:** Use a **Quarto workflow** `r fontawesome::fa("arrow-right")` everything (code, text, metadata) in one place. Let `Quarto` do the magic

![](images/2023_05_11_quarto/quarto_workflow.png)

. . .

**Advantages** of this workflow:

-   Easy to redo analysis
-   No more copy pasting
-   Reproducibility `r fontawesome::fa("arrow-right")` workflow independent of the person that wrote it

## The basic Quarto workflow

1.  **Create** a `.qmd` document
2.  **Write** the document

-   *text* that e.g. introduces you topic, interprets your results, ...
-   *code* (R, Python, Julia) that produces numbers, figures, tables, ...
-   *metadata* that defines how the result should look like (e.g. which output format)

3.  **Render** the document to a defined output format (e.g. PDF) using `Quarto`

## Step 1 - Create the document

Open R Studio and go to `File -> New File -> Quarto Document`

```{r}
#| echo: false
knitr::include_graphics("images/2023_05_11_quarto/new_quarto_doc.jpg")
```

Just click `Create` and the file will open in R Studio.

In other environments you can just create and empty file with `.qmd` ending

## Step 2 - Write the document

::: columns
::: {.column width="60%"}
::: {layout="[[-1], [1], [-1]]"}
```{r}
#| echo: false
knitr::include_graphics("images/2023_05_11_quarto/basic_doc_annotate_sections.jpg")
```
:::
:::

::: {.column width="38%"}

:::{.nonincremental}
You can edit:

-   [YAML header]{style="color:#b31464"}: Metadata and control of the output format
-   [Markdown text]{style="color:#00abcd"}: Formatted text body
-   [Code chunks]{style="color:#ffcf01"}: Python, R, Julia code

:::
:::
:::

## Step 3 - Render the document

::: nonincremental
-   Click the `Render` button in R Studio
-   Keyboard shortcut `Ctrl + Shift + K`
-   Call the `quarto::quarto_render()` function
-   In the terminal: `quarto render doc.qmd`
:::

## Step 3 - Render the document

What happens during rendering?

```{r}
#| fig-alt: A schematic representing rendering of Quarto documents from .qmd, to knitr or jupyter, to plain text markdown, then converted by pandoc into any number of output types including html, PDF, or Word document.
#| fig-cap: Artwork from "Hello, Quarto" keynote by Julia Lowndes and Mine Çetinkaya-Rundel,presented at RStudio Conference 2022. Illustrated by Allison Horst.
knitr::include_graphics("images/2023_05_11_quarto/qmd_render_schema.png")
```

# Basic Elements of a `.qmd` document

> Text body, Code, YAML header

## The text body - Markdown

-   Markdown is a simple markup language to create formatted text

. . .

Markdown allows you to do simple things like

- Making text bold or italic
- Creating headers of different levels
- Creating bullet lists

. . .

Or more complex things like:

- Including images, links or footnotes
- Add citations and cross-references
- Latex style mathematical formulas

## The text body - Markdown

If you don't want to use markdown, there is a really nice feature in R Studio:
**The visual editor**.

## The visual editor

Convenient, word-like interface for formatting text and adding features.

```{r}
#|label: fig-visual-editor
knitr::include_graphics("images/2023_05_11_quarto/visual_editor.png")
```

## The visual editor

Using the visual editor, makes many things that would be painful in Markdown 
really easy.

**My favorite feature** in the visual editor: 

- Add citations (`Insert -> Citation`) from Zotero library, DOI search, PubMed, ...

## The Code

Code can be included in **code chunks** as **inline code**

-   Code chunks can contain any type of R/Python/Julia code
-   Code is (by default) executed and output is included in document
    -   Text output
    -   Figures
    -   ...

## The Code

**Inline code** starts and ends with 1 backtick

```{r, echo=FALSE}
code = '`r `'
cat(code)
```

. . .

**Example**

``` md
The mean of the values 1, 2 and 3 is `r knitr::inline_expr("mean(1:3)")`
```

looks like this:

The mean of the values 1, 2 and 3 is `r mean(1:3)`.

## The Code

**Code chunks** starts and ends with 3 backticks

```` md
```{{r}}
library(ggplot2)
ggplot(airquality, aes(Temp, Ozone)) + 
  geom_point() + 
  geom_smooth(method = "loess")
```
````

<br>

. . .

````         
```{{python}}
import numpy as np
import matplotlib.pyplot as plt

r = np.arange(0, 2, 0.01)
theta = 2 * np.pi * r
fig, ax = plt.subplots(subplot_kw = {'projection': 'polar'})
ax.plot(theta, r)
ax.set_rticks([0.5, 1, 1.5, 2])
ax.grid(True)
plt.show()
```
````

## The Code

**Insert a code chunk**

-   Insert a code chunk by going to `Code` -\> `Insert chunk`

-   Use the keyboard shortcut `Ctrl + Alt + I` / `Cmd + Option + I`

-   Inline chunks have to be typed or use the `</>` symbol in visual mode

## The Code

**Run code chunk**

-   Code chunks are evaluated by `knitr` when rendering the document

-   Code chunks can also be run like normal R code

-   Run Code chunk by clicking on the green arrow next to the chunk

. . .

![](images/2023_05_11_quarto/run_code_chunk.png)

## The code

Code chunk have special comments that start with `#|`, e.g.

```` md
```{{r}}
#| label: fig-airquality
#| fig-cap: Temperature and ozone level.
#| include: false

library(ggplot2)

ggplot(airquality, aes(Temp, Ozone)) + 
  geom_point() + 
  geom_smooth(method = "loess")
```
````

- `label`: Figure and chunk label that can be referred to in text
- `fig-cap`: Figure caption
- `include`: Include the output (i.e. the plot) in the document but don't show the code

## Include image via code chunk

Include an image from a code chunk via `knitr::include_graphics()`.

```` md
```{{r}}
#| echo: false
#| out.width: "20%"
#| fig-align: center
#| fig-cap: Quarto logo
#| fig-cap-location: margin
knitr::include_graphics("images/2023_05_11_quarto/quarto_straight.png")
```
````

```{r}
#| echo: false
#| out.width: "20%"
#| fig-align: center
#| fig-cap: Quarto logo
#| fig-cap-location: margin
knitr::include_graphics("images/2023_05_11_quarto/quarto_straight.png")
```

## YAML header

. . .

**For Metadata**

``` yaml
---
title: "My first document"
subtitle: "Whatever subtitle makes sense"
author: "Selina Baldauf"
date: "`r knitr::inline_expr("Sys.Date()")`"
---
```

-   Inline R code can print the current date at knitting time

## YAML header

**For document output formats**

``` yaml
---
title: "My first document"
author: "Selina Baldauf"
date: "`r knitr::inline_expr("Sys.Date()")`"
format: html
---
```

. . .

You can also specify multiple output formats

``` yaml
---
title: "My first document"
author: "Selina Baldauf"
date: "`r knitr::inline_expr("Sys.Date()")`"
format: 
  html: default
  pdf: default
  docx: default
---
```

# YAML header

**For document options**

::: columns
::: {.column width="45%"}
::: nonincremental
-   Some options are shared between formats, some are specific to one format
-   Be careful to get the indentation right!
:::
:::

::: {.column width="45%"}

:::{.fragment}

``` yaml
---
title: "My first document"
author: "Selina Baldauf"
date: "`r knitr::inline_expr("Sys.Date()")`"
format: 
  html: 
    number-sections: true
    toc: true
    toc-location: left
    code-fold: true
    code-copy: true
    df-print: kable
  pdf: 
    toc: true
    number-sections: true
    df-print: kable
  docx: default
---
```

:::
:::
:::

## YAML header

**Execute options**

-   Default options for code chunks
-   Can be overwritten by local comments in code chunks

. . .

``` yaml
---
title: "My first document"
author: "Selina Baldauf"
date: "`r knitr::inline_expr("Sys.Date()")`"
format: html
execute: 
  echo: false
  warning: false
---
```

## References for all the elements

:::{.nonincremental}

-   [Mardown syntax reference](https://quarto.org/docs/authoring/markdown-basics.html)
-   YAML header options:
    -   [HTML](https://quarto.org/docs/reference/formats/html.html)
    -   [PDF](https://quarto.org/docs/reference/formats/pdf.html)
    -   [DOCX](https://quarto.org/docs/reference/formats/docx.html)
-   Code chunks:
    -   [R code](https://quarto.org/docs/computations/r.html)
    -   [Python code](https://quarto.org/docs/computations/python.html)

:::    

## Summary

- Quarto can combine formatted text and code to create reproducible documents

. . .

**Use cases for scientists**

- Write reports and documents about data analysis
- Use `qmd` instead of `.R` files to add text already to the code (e.g. for interpretation or methods)
- Great for teaching because you can add explanations to your code
- Many more ...

## Outlook

Quarto offers many more things like:

- Presentations (Powerpoint or Revealjs/HTML)
- Websites
- Easily publish your documents or websites on [quartopub](https://quartopub.com/) or Github
  - See [here](https://quarto.org/docs/publishing/) for more information
- Control the rendering process via R scripts using `quarto::quarto_render()`
- Parameterized reports

## Next lecture

#### Version control with Git

Git is an essential skill if you use any programming language. 
It allows you to keep track of changes over time, collaborate with others,
and maintain a clear and organized file structure. This can save time, improve 
research efficiency, and makes it easy to publish your code.

<br>

. . .

:date: 15th June :clock4: 4-5 p.m. :round_pushpin: Webex

:e-mail: For topic suggestions and/or feedback [send me an email](mailto:selina.baldauf@fu-berlin.de)

:bell: [Subscribe to the mailing list](https://lists.fu-berlin.de/listinfo/toolsAndTips)

## Thank you for your attention :) {background-image="images/2023_05_11_quarto/quarto_thankyou.png" background-size="cover"}
Questions?

"Artwork from "Hello, Quarto" keynote by Julia Lowndes and Mine Çetinkaya-Rundel, presented at RStudio Conference 2022. Illustrated by Allison Horst."

# References

:::{.nonincremental}
- [Quarto website](https://quarto.org/) offers everything you need to get started
  - [Download Quarto and starting guide](https://quarto.org/docs/get-started/) for different IDEs
  - [Guides for different output formats](https://quarto.org/docs/guide/)
  - [Gallery with Examples](https://quarto.org/docs/gallery/)
- [Quarto introduction workshop](https://www.youtube.com/watch?v=yvi5uXQMvu4) on Youtube
- [A curated collection of resources](https://github.com/mcanouil/awesome-quarto#featured-new-releases)

:::


